<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bình Hoa Gốm Bát Tràng | Chi Tiết Sản Phẩm | Thủ Công Việt</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="main-header">
        <div class="container header-content">
            <div class="logo">
                <a href="index.html">
                    <h1>Thủ Công Việt</h1>
                </a>
            </div>
            
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Trang Chủ</a></li>
                    <li><a href="san-pham.html" class="active">Sản Phẩm</a></li>
                    <li><a href="gioi-thieu.html">Giới Thiệu</a></li>
                    <li><a href="lien-he.html">Liên Hệ</a></li>
                </ul>
            </nav>

            <div class="auth-area">
                <span id="authLink">
                    <a href="login.html" class="btn btn-primary"><i class="fas fa-user"></i> Đăng nhập</a>
                </span>
                <a href="admin-dashboard.html" id="adminDashboardLink" class="btn btn-secondary" style="display: none; margin-left: 10px;">
                    <i class="fas fa-chart-line"></i> Quản trị
                </a>
                <a href="cart.html" class="nav-icon-link cart-icon-count" style="margin-left: 10px;">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
            </div>
        </div>
    </header>

    <main>
        <div class="container breadcrumb">
            <a href="index.html">Trang chủ</a> / <a href="san-pham.html">Sản phẩm</a> / Bình Hoa Gốm Bát Tràng
        </div>
        
        <section class="product-detail-section">
            <div class="container product-detail-grid">

                <div class="product-gallery">
                    <div class="main-image">
                        <img src="images/sp_gom_1.jpg" alt="Bình Hoa Gốm Bát Tràng, góc nhìn chính" id="mainProductImage">
                    </div>
                    <div class="thumbnail-gallery">
                        <img src="images/sp_gom_1.jpg" alt="Ảnh 1" class="thumbnail active" onclick="changeImage('images/sp_gom_1.jpg', this)">
                        <img src="images/sp_gom_1_phu_1.jpg" alt="Ảnh 2" class="thumbnail" onclick="changeImage('images/sp_gom_1_phu_1.jpg', this)">
                        <img src="images/sp_gom_1_phu_2.jpg" alt="Ảnh 3" class="thumbnail" onclick="changeImage('images/sp_gom_1_phu_2.jpg', this)">
                    </div>
                </div>

                <div class="product-info-area">
                    <h1 class="product-title">Bình Hoa Gốm Bát Tràng</h1>
                    <div class="product-price">
                        <span class="current-price">1.250.000₫</span>
                    </div>
                    
                    <div class="short-description">
                        <p>Bình gốm thủ công men rạn cổ, vẽ tay họa tiết sen vàng, mang lại vẻ đẹp truyền thống và sang trọng cho không gian của bạn.</p>
                        <p>Sản phẩm độc bản, được nung ở nhiệt độ cao, đảm bảo độ bền vượt trội.</p>
                    </div>

                    <div class="product-attributes">
                        <div class="attribute-item">
                            <label>Chất liệu:</label>
                            <span>Gốm sứ cao cấp, Men rạn</span>
                        </div>
                        <div class="attribute-item">
                            <label>Kích thước:</label>
                            <span>Cao 30cm, Đường kính 15cm</span>
                        </div>
                        <div class="attribute-item">
                            <label>Xuất xứ:</label>
                            <span>Làng gốm Bát Tràng, Việt Nam</span>
                        </div>
                    </div>

                    <div class="purchase-actions">
                        <div class="quantity-selector">
                            <label for="quantity">Số lượng:</label>
                            <input type="number" id="quantity" value="1" min="1" max="10">
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-add-to-cart" id="btnAddToCart"><i class="fas fa-cart-plus"></i> Thêm vào giỏ hàng</button>
                            <button class="btn btn-buy-now" id="btnBuyNow">Mua ngay</button>
                        </div>
                    </div>
                    
                    <div class="policy-links">
                        <p><i class="fas fa-shield-alt"></i> Chính sách bảo hành: 1 đổi 1 trong 7 ngày.</p>
                        <p><i class="fas fa-truck"></i> Giao hàng miễn phí cho đơn hàng trên 2.000.000₫.</p>
                    </div>

                </div>
            </div>

            <div class="container detail-tabs">
                <h3>Mô Tả Chi Tiết</h3>
                <div class="description-content">
                    <p>Mỗi chiếc bình gốm là sự kết hợp hoàn hảo giữa nghệ thuật truyền thống và kỹ thuật nung gốm hiện đại. Bình được tạo hình thủ công, qua nhiều công đoạn tỉ mỉ của nghệ nhân. Men rạn là loại men đặc trưng của Bát Tràng, tạo nên vẻ đẹp cổ kính và độc đáo cho sản phẩm. Thích hợp trang trí phòng khách, phòng làm việc hoặc làm quà tặng cao cấp.</p>
                    <ul>
                        <li><i class="fas fa-check-circle"></i> Sản phẩm vẽ tay 100%.</li>
                        <li><i class="fas fa-check-circle"></i> Men rạn tự nhiên, không độc hại.</li>
                        <li><i class="fas fa-check-circle"></i> Màu sắc bền vững theo thời gian.</li>
                    </ul>
                </div>
                
                <h3>Đánh Giá Sản Phẩm (4.8/5.0)</h3>
                <div class="reviews-placeholder">
                    [Khu vực này sẽ hiển thị các nhận xét và đánh giá của khách hàng]
                </div>
            </div>
        </section>

        <section class="related-products featured-products">
            <div class="container">
                <h2>Sản Phẩm Tương Tự</h2>
                <div class="product-grid">
                    <div class="product-item">
                        <a href="chi-tiet-sp-3.html" class="product-link">
                            <img src="images/sp_tranh_theu.jpg" alt="Tranh Thêu Phong Cảnh">
                            <div class="product-info">
                                <h3 class="product-name">Tranh Thêu Phong Cảnh</h3>
                                <p class="product-price">4.500.000₫</p>
                                <span class="btn btn-detail">Xem Chi Tiết</span>
                            </div>
                        </a>
                    </div>
                    <div class="product-item">
                        <a href="chi-tiet-sp-4.html" class="product-link">
                            <img src="images/sp_dodong.jpg" alt="Tượng Đồng Mini">
                            <div class="product-info">
                                <h3 class="product-name">Tượng Đồng Mini</h3>
                                <p class="product-price">850.000₫</p>
                                <span class="btn btn-detail">Xem Chi Tiết</span>
                            </div>
                        </a>
                    </div>
                    <div class="product-item">
                        <a href="chi-tiet-sp-5.html" class="product-link">
                            <img src="images/sp_may_tre.jpg" alt="Giỏ Mây Tre Đan">
                            <div class="product-info">
                                <h3 class="product-name">Giỏ Mây Tre Đan</h3>
                                <p class="product-price">320.000₫</p>
                                <span class="btn btn-detail">Xem Chi Tiết</span>
                            </div>
                        </a>
                    </div>
                    
                </div>
            </div>
        </section>

    </main>

    <footer class="main-footer">
        <div class="container footer-grid">
            <div class="footer-col contact-info">
                <h3>Liên Hệ</h3>
                <p><i class="fas fa-map-marker-alt"></i> **Địa chỉ:** Trường đại học công nghệ Đông Á</p>
                <p><i class="fas fa-phone"></i> **Điện thoại:** 0987.654.321</p>
                <p><i class="fas fa-envelope"></i> **Email:** contact@thucongviet.vn</p>
            </div>
            
            <div class="footer-col policies">
                <h3>Chính Sách</h3>
                <ul>
                    <li><a href="chinh-sach-doi-tra.html">Chính sách đổi trả</a></li>
                    <li><a href="chinh-sach-bao-mat.html">Chính sách bảo mật</a></li>
                    <li><a href="dieu-khoan-su-dung.html">Điều khoản sử dụng</a></li>
                </ul>
            </div>

            <div class="footer-col social-map">
                <h3>Kết Nối</h3>
                <div class="social-links">
                    <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="#" target="_blank"><i class="fab fa-youtube"></i></a>
                </div>
                <div class="map-placeholder">
                    <p>Vị trí trên bản đồ</p>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <p>&copy; 2025 Thủ Công Việt. Bảo lưu mọi quyền.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // ===========================================
        // MÔ PHỎNG LOGIC AUTH 
        // ===========================================
        function getCurrentUser() {
            try {
                const userData = localStorage.getItem('currentUser');
                // Mô phỏng dữ liệu người dùng
                // Ví dụ: return { name: 'Admin', role: 'manager' }; 
                return userData ? JSON.parse(userData) : null;
            } catch (e) {
                return null;
            }
        }
        function logout() {
            localStorage.removeItem('currentUser');
        }

        // ===========================================
        // HÀM CHỨC NĂNG CHUNG
        // ===========================================

        // 1. Chức năng Đổi ảnh Thumbnail
        function changeImage(src, element) {
            document.getElementById('mainProductImage').src = src;
            
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach(thumb => {
                thumb.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
        }

        // 2. Chức năng Giỏ hàng - Lấy dữ liệu
        function getCart() {
            try {
                const cartData = localStorage.getItem('cart');
                return cartData ? JSON.parse(cartData) : [];
            } catch (e) {
                console.error("Lỗi khi đọc giỏ hàng:", e);
                return [];
            }
        }

        // 3. Chức năng Giỏ hàng - Lưu dữ liệu
        function saveCart(cart) {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // 4. Cập nhật số lượng hiển thị trên icon giỏ hàng
        function updateCartCount() {
            const cart = getCart();
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountElement = document.querySelector('.cart-count'); 
            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
            }
        }

        // 5. Hàm chính: Thêm sản phẩm vào giỏ hàng
        function addToCart(productId, name, price, quantity) {
            let cart = getCart();
            const existingItemIndex = cart.findIndex(item => item.id === productId);

            // Xử lý giá tiền: loại bỏ dấu phân cách (.), đơn vị (₫) và chuyển sang số
            const cleanPrice = price.replace(/[.₫]/g, '').trim();
            const numericPrice = parseInt(cleanPrice);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
            } else {
                cart.push({ 
                    id: productId, 
                    name: name, 
                    price: numericPrice, 
                    quantity: quantity 
                });
            }

            saveCart(cart);
            updateCartCount(); // Cập nhật số lượng hiển thị sau khi thêm
            alert(`✅ Đã thêm ${quantity} x "${name}" vào giỏ hàng!`);
        }


        // ===========================================
        // XỬ LÝ SỰ KIỆN KHI DOM ĐÃ TẢI XONG
        // ===========================================
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- LOGIC GIỎ HÀNG/MUA HÀNG ---
            const productId = "SP-GOM-001"; // ID sản phẩm tĩnh
            const productName = document.querySelector('.product-title').textContent.trim();
            const productPriceText = document.querySelector('.current-price').textContent.trim(); 

            // Lấy nút bằng ID (Đã sửa lỗi)
            const quantityInput = document.getElementById('quantity');
            const btnAddToCart = document.getElementById('btnAddToCart'); 
            const btnBuyNow = document.getElementById('btnBuyNow');     

            // 1. Gắn sự kiện: Thêm vào giỏ hàng
            if (btnAddToCart && quantityInput) {
                btnAddToCart.addEventListener('click', () => {
                    const quantity = parseInt(quantityInput.value);
                    if (quantity > 0) {
                        addToCart(productId, productName, productPriceText, quantity);
                    } else {
                        alert("Vui lòng nhập số lượng hợp lệ.");
                    }
                });
            } else {
                console.error("Lỗi: Không tìm thấy nút 'Thêm vào giỏ hàng' hoặc input số lượng.");
            }

            // 2. Gắn sự kiện: Mua ngay (Thêm vào giỏ hàng và chuyển trang)
            if (btnBuyNow && quantityInput) {
                btnBuyNow.addEventListener('click', () => {
                    const quantity = parseInt(quantityInput.value);
                    if (quantity > 0) {
                        addToCart(productId, productName, productPriceText, quantity);
                        // Chuyển hướng ngay sau khi thêm
                        window.location.href = "cart.html"; 
                    } else {
                        alert("Vui lòng nhập số lượng hợp lệ để mua ngay.");
                    }
                });
            }
            
            // --- LOGIC ĐĂNG NHẬP/ĐĂNG XUẤT (Auth) ---
            const user = getCurrentUser(); 
            const authLink = document.getElementById('authLink');
            const adminDashboardLink = document.getElementById('adminDashboardLink');

            if (user) {
                // Đã đăng nhập
                const roleText = user.role === 'manager' ? 'QL' : user.role === 'staff' ? 'NV' : 'KH';

                authLink.innerHTML = `
                    <span>
                        <i class="fas fa-user"></i> 
                        Xin chào, 
                        <span style="font-weight: 600; color: #6d9f71;">${user.name}</span> 
                        (<span style="font-weight: 600;">${roleText}</span>)
                    </span>
                    <a href="#" id="btnLogout" style="margin-left: 10px; color: #ff6347; font-weight: 600;">(Đăng xuất)</a>
                `;
                
                if (adminDashboardLink) {
                    if (user.role === 'manager' || user.role === 'staff') {
                        adminDashboardLink.style.display = 'inline-block';
                    } else {
                        adminDashboardLink.style.display = 'none';
                    }
                }
                
                // Gắn sự kiện Đăng xuất
                document.getElementById('btnLogout').addEventListener('click', (e) => {
                    e.preventDefault();
                    logout();
                    window.location.reload(); 
                });
            } else {
                // Chưa đăng nhập
                authLink.innerHTML = `<a href="login.html" class="btn btn-primary"><i class="fas fa-user"></i> Đăng nhập</a>`;
                if (adminDashboardLink) {
                    adminDashboardLink.style.display = 'none';
                }
            }

            // Cập nhật số lượng giỏ hàng ban đầu
            updateCartCount();
        });
    </script>

</body>
</html>