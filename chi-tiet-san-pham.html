<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n L√Ω S·∫£n Ph·∫©m - Th·ªß C√¥ng Vi·ªát</title>
<style>
:root {
    --primary-color: #8B4513;
    --primary-hover: #65340f;
    --danger-color: #dc3545;
    --danger-hover: #a71d2a;
    --edit-color: #007bff;
    --edit-hover: #0056b3;
    --success-color: #28a745;
    --success-hover: #1e7e34;
}
body { font-family: "Segoe UI", sans-serif; background: #f8f7f5; margin: 0; color: #333; }
.product-listing-page { max-width: 1200px; margin: 30px auto; padding: 20px; }

/* MENU DANH M·ª§C */
nav.product-categories { margin-bottom: 40px; text-align: center; }
nav.product-categories button {
    background: none;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    padding: 10px 20px;
    border-radius: 50px;
    font-weight: 600;
    margin: 5px;
    cursor: pointer;
    transition: 0.3s;
}
nav.product-categories button.active,
nav.product-categories button:hover {
    background: var(--primary-color);
    color: #fff;
}

/* FORM TH√äM */
.add-product-section {
    background: #fff; padding: 30px; border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.07); margin-bottom: 50px;
}
#add-product-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 20px; }
.form-group { display: flex; flex-direction: column; }
.form-group label { font-weight: 600; margin-bottom: 6px; }
.form-group input, .form-group select {
    padding: 10px; border: 2px solid #ddd; border-radius: 8px;
}
.btn-add {
    background: var(--success-color); color: #fff; border: none; padding: 12px;
    border-radius: 8px; cursor: pointer; transition: 0.3s;
}
.btn-add:hover { background: var(--success-hover); }

/* L∆Ø·ªöI S·∫¢N PH·∫®M */
.product-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 30px; }
.product-item { background:#fff; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.07); overflow:hidden; }
.product-item img { width:100%; height:270px; object-fit:cover; }
.product-details { padding:20px; text-align:center; }
.product-details h3 { margin:10px 0; }
.price { font-weight:700; margin:10px 0 20px; }
.product-actions { display:flex; justify-content:center; gap:10px; }
.btn-action { border:none; color:#fff; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:600; }
.btn-edit { background:var(--edit-color); }
.btn-delete { background:var(--danger-color); }
.btn-delete-all {
    background: var(--danger-color); color:#fff; border:none; padding:10px 18px;
    border-radius:8px; cursor:pointer; font-weight:600; margin-bottom:20px;
}
.btn-delete-all:hover { background: var(--danger-hover); }

/* MODAL */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
.modal.show { display:flex; }
.modal-content { background:#fff; padding:30px; border-radius:12px; width:90%; max-width:600px; position:relative; }
.btn-close { position:absolute; right:20px; top:15px; font-size:28px; cursor:pointer; }
.btn-save { background:var(--primary-color); color:#fff; border:none; padding:12px; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>

<main class="product-listing-page">
    <h2>Trang Qu·∫£n L√Ω S·∫£n Ph·∫©m</h2>

    <!-- MENU DANH M·ª§C -->
    <nav class="product-categories" id="category-menu">
        <button data-cat="all" class="active">T·∫•t c·∫£</button>
        <button data-cat="G·ªëm s·ª©">G·ªëm s·ª©</button>
        <button data-cat="ƒê·ªì g·ªó">ƒê·ªì g·ªó</button>
        <button data-cat="Th·ªï c·∫©m">Th·ªï c·∫©m</button>
        <button data-cat="Tranh th√™u">Tranh th√™u</button>
    </nav>

    <!-- FORM TH√äM -->
    <section class="add-product-section">
        <h3>Th√™m S·∫£n Ph·∫©m M·ªõi</h3>
        <form id="add-product-form">
            <div class="form-group">
                <label for="add-name">T√™n s·∫£n ph·∫©m:</label>
                <input type="text" id="add-name" required>
            </div>
            <div class="form-group">
                <label for="add-price">Gi√° (VNƒê):</label>
                <input type="number" id="add-price" required>
            </div>
            <div class="form-group">
                <label for="add-category">Danh m·ª•c:</label>
                <select id="add-category" required>
                    <option value="">-- Ch·ªçn lo·∫°i --</option>
                    <option value="G·ªëm s·ª©">G·ªëm s·ª©</option>
                    <option value="ƒê·ªì g·ªó">ƒê·ªì g·ªó</option>
                    <option value="Th·ªï c·∫©m">Th·ªï c·∫©m</option>
                    <option value="Tranh th√™u">Tranh th√™u</option>
                </select>
            </div>
            <div class="form-group">
                <label for="add-image">Ch·ªçn ·∫£nh:</label>
                <input type="file" id="add-image" accept="image/*" required>
            </div>
            <button type="submit" class="btn-add">Th√™m Ngay</button>
        </form>
    </section>

    <button class="btn-delete-all" id="clearAllBtn">üóëÔ∏è X√≥a T·∫•t C·∫£ D·ªØ Li·ªáu</button>

    <h2 id="list-title" style="font-size:2rem;">T·∫•t C·∫£ S·∫£n Ph·∫©m</h2>
    <section class="product-grid" id="product-grid"></section>
</main>

<!-- MODAL S·ª¨A -->
<div id="edit-modal" class="modal">
    <div class="modal-content">
        <span class="btn-close" id="close-modal">&times;</span>
        <h3>Ch·ªânh S·ª≠a S·∫£n Ph·∫©m</h3>
        <form id="edit-product-form">
            <input type="hidden" id="edit-id">
            <div class="form-group">
                <label for="edit-name">T√™n s·∫£n ph·∫©m:</label>
                <input type="text" id="edit-name" required>
            </div>
            <div class="form-group">
                <label for="edit-price">Gi√° (VNƒê):</label>
                <input type="number" id="edit-price" required>
            </div>
            <div class="form-group">
                <label for="edit-category">Danh m·ª•c:</label>
                <select id="edit-category" required>
                    <option value="G·ªëm s·ª©">G·ªëm s·ª©</option>
                    <option value="ƒê·ªì g·ªó">ƒê·ªì g·ªó</option>
                    <option value="Th·ªï c·∫©m">Th·ªï c·∫©m</option>
                    <option value="Tranh th√™u">Tranh th√™u</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit-image">ƒê·ªïi ·∫£nh (t√πy ch·ªçn):</label>
                <input type="file" id="edit-image" accept="image/*">
            </div>
            <button type="submit" class="btn-save">L∆∞u Thay ƒê·ªïi</button>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
    const LS_KEY = "productData_v1";
    let products = JSON.parse(localStorage.getItem(LS_KEY)) || [
        { id: 1, name: "B√¨nh G·ªëm H·ªça Ti·∫øt Sen", price: 950000, category: "G·ªëm s·ª©", image: "https://via.placeholder.com/300x270/D2B48C/FFFFFF?text=G·ªëm+S·ª©" },
        { id: 2, name: "T∆∞·ª£ng G·ªó Di L·∫∑c", price: 4200000, category: "ƒê·ªì g·ªó", image: "https://via.placeholder.com/300x270/8B4513/FFFFFF?text=ƒê·ªì+G·ªó" },
        { id: 3, name: "KhƒÉn Th·ªï C·∫©m", price: 680000, category: "Th·ªï c·∫©m", image: "https://via.placeholder.com/300x270/CD853F/FFFFFF?text=Th·ªï+C·∫©m" },
        { id: 4, name: "Tranh Th√™u Phong C·∫£nh", price: 1500000, category: "Tranh th√™u", image: "https://via.placeholder.com/300x270/DAA520/FFFFFF?text=Tranh+Th√™u" }
    ];

    const grid = document.getElementById("product-grid");
    const listTitle = document.getElementById("list-title");
    const addForm = document.getElementById("add-product-form");
    const editForm = document.getElementById("edit-product-form");
    const editModal = document.getElementById("edit-modal");
    const closeModal = document.getElementById("close-modal");
    const categoryMenu = document.getElementById("category-menu");
    const clearAllBtn = document.getElementById("clearAllBtn");
    let currentFilter = "all";

    function saveToLocal(){ localStorage.setItem(LS_KEY, JSON.stringify(products)); }
    function formatCurrency(n){ return new Intl.NumberFormat('vi-VN').format(n) + " VNƒê"; }

    function renderProducts(){
        grid.innerHTML = '';
        const filtered = currentFilter==="all" ? products : products.filter(p=>p.category===currentFilter);
        listTitle.innerHTML = currentFilter==="all"
            ? `T·∫•t C·∫£ S·∫£n Ph·∫©m (${filtered.length})`
            : `ƒêang xem: ${currentFilter} (${filtered.length})`;
        filtered.forEach(p=>{
            const div=document.createElement("div");
            div.className="product-item";
            div.dataset.id=p.id;
            div.innerHTML=`
                <img src="${p.image}" alt="${p.name}">
                <div class="product-details">
                    <h3>${p.name}</h3>
                    <p class="price">${formatCurrency(p.price)}</p>
                    <p style="color:#777">${p.category}</p>
                    <div class="product-actions">
                        <button class="btn-action btn-edit">S·ª≠a</button>
                        <button class="btn-action btn-delete">X√≥a</button>
                    </div>
                </div>`;
            grid.appendChild(div);
        });
    }

    categoryMenu.addEventListener("click", e=>{
        if(e.target.tagName!=="BUTTON") return;
        document.querySelectorAll("#category-menu button").forEach(btn=>btn.classList.remove("active"));
        e.target.classList.add("active");
        currentFilter = e.target.dataset.cat;
        renderProducts();
    });

    addForm.addEventListener("submit", function(e){
        e.preventDefault();
        const name = document.getElementById("add-name").value;
        const price = parseFloat(document.getElementById("add-price").value);
        const category = document.getElementById("add-category").value;
        const file = document.getElementById("add-image").files[0];
        if(!file){ alert("Vui l√≤ng ch·ªçn ·∫£nh"); return; }

        const reader = new FileReader();
        reader.onload = function(evt){
            const newProduct = {
                id: Date.now(),
                name, price, category,
                image: evt.target.result
            };
            products.unshift(newProduct);
            saveToLocal();
            renderProducts();
            addForm.reset();
        };
        reader.readAsDataURL(file);
    });

    grid.addEventListener("click", e=>{
        const item = e.target.closest(".product-item");
        if(!item) return;
        const id = parseInt(item.dataset.id);
        if(e.target.classList.contains("btn-edit")) openEditModal(id);
        if(e.target.classList.contains("btn-delete")) deleteProduct(id);
    });

    function openEditModal(id){
        const p = products.find(x=>x.id===id);
        if(!p) return;
        document.getElementById("edit-id").value = p.id;
        document.getElementById("edit-name").value = p.name;
        document.getElementById("edit-price").value = p.price;
        document.getElementById("edit-category").value = p.category;
        document.getElementById("edit-image").value = "";
        editModal.classList.add("show");
    }

    closeModal.addEventListener("click", ()=>editModal.classList.remove("show"));
    editModal.addEventListener("click", e=>{ if(e.target===editModal) editModal.classList.remove("show"); });

    editForm.addEventListener("submit", function(e){
        e.preventDefault();
        const id = parseInt(document.getElementById("edit-id").value);
        const name = document.getElementById("edit-name").value;
        const price = parseFloat(document.getElementById("edit-price").value);
        const category = document.getElementById("edit-category").value;
        const file = document.getElementById("edit-image").files[0];
        const idx = products.findIndex(x=>x.id===id);
        if(idx===-1) return;

        if(file){
            const reader = new FileReader();
            reader.onload = function(evt){
                products[idx].image = evt.target.result;
                products[idx].name = name;
                products[idx].price = price;
                products[idx].category = category;
                saveToLocal(); renderProducts(); editModal.classList.remove("show");
            };
            reader.readAsDataURL(file);
        } else {
            products[idx].name = name;
            products[idx].price = price;
            products[idx].category = category;
            saveToLocal(); renderProducts(); editModal.classList.remove("show");
        }
    });

    function deleteProduct(id){
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")){
            products = products.filter(x=>x.id!==id);
            saveToLocal();
            renderProducts();
        }
    }

    clearAllBtn.addEventListener("click", ()=>{
        if(confirm("‚ö†Ô∏è X√≥a to√†n b·ªô s·∫£n ph·∫©m trong kho?")){
            localStorage.removeItem(LS_KEY);
            products = [];
            renderProducts();
        }
    });

    renderProducts();
});
</script>
</body>
</html>
